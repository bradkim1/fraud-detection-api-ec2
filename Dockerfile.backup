# Dockerfile for Fraud Detection Environment
FROM python:3.10-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    git \
    vim \
    wget \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace

# Install Python packages
RUN pip install --no-cache-dir \
    jupyter \
    notebook \
    pandas \
    numpy \
    scikit-learn==1.2.2 \
    matplotlib \
    seaborn \
    xgboost \
    fastapi \
    uvicorn \
    joblib \
    ipywidgets

# Create directories for model files, notebooks, and data
RUN mkdir -p /workspace/model /workspace/notebooks /workspace/data

# Set up Jupyter configuration
RUN mkdir -p /root/.jupyter
RUN echo "c.NotebookApp.token = ''" > /root/.jupyter/jupyter_notebook_config.py
RUN echo "c.NotebookApp.password = ''" >> /root/.jupyter/jupyter_notebook_config.py
RUN echo "c.NotebookApp.ip = '0.0.0.0'" >> /root/.jupyter/jupyter_notebook_config.py
RUN echo "c.NotebookApp.allow_root = True" >> /root/.jupyter/jupyter_notebook_config.py
RUN echo "c.NotebookApp.open_browser = False" >> /root/.jupyter/jupyter_notebook_config.py

# Copy model builder script
COPY fraud_model_builder.py /workspace/
RUN chmod +x /workspace/fraud_model_builder.py

# Copy sample notebook
#COPY fraud_model_setup.ipynb /workspace/notebooks/

# Expose ports for Jupyter and FastAPI
EXPOSE 8888 8000

# Create setup script for launching Jupyter
RUN echo '#!/bin/bash\ncd /workspace\njupyter notebook --port=8888 --allow-root --ip=0.0.0.0 --no-browser' > /workspace/start_jupyter.sh
RUN chmod +x /workspace/start_jupyter.sh

# Set the command to run Jupyter Notebook
CMD ["/workspace/start_jupyter.sh"]
